"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.Snake = void 0;

var _interfaces = require("../interfaces/interfaces");

var _Square = require("./Square");

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

function _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }

var Snake = function Snake(position, moveRange) {
  var _this = this;

  _classCallCheck(this, Snake);

  _defineProperty(this, "segments", []);

  _defineProperty(this, "moveRange", void 0);

  _defineProperty(this, "addSegment", function (direction) {
    var lastSegment = _this.segments[_this.segments.length - 1];
    var newSegment = new _Square.Square(null, "#39B4BA", _this.moveRange);

    if (_this.segments.length < 2) {
      switch (direction) {
        case _interfaces.Direction.Up:
          newSegment.position = {
            x: lastSegment.position.x,
            y: lastSegment.position.y + _this.moveRange
          };
          break;

        case _interfaces.Direction.Down:
          newSegment.position = {
            x: lastSegment.position.x,
            y: lastSegment.position.y - _this.moveRange
          };
          break;

        case _interfaces.Direction.Left:
          newSegment.position = {
            x: lastSegment.position.x + _this.moveRange,
            y: lastSegment.position.y
          };
          break;

        case _interfaces.Direction.Right:
          newSegment.position = {
            x: lastSegment.position.x - _this.moveRange,
            y: lastSegment.position.y
          };
          break;
      }
    } else {
      var penultSegment = _this.segments[_this.segments.length - 2];

      if (penultSegment.position.x === lastSegment.position.x && penultSegment.position.y < lastSegment.position.y) {
        newSegment.position = {
          x: lastSegment.position.x,
          y: lastSegment.position.y + _this.moveRange
        };
      } else if (penultSegment.position.x === lastSegment.position.x && penultSegment.position.y > lastSegment.position.y) {
        newSegment.position = {
          x: lastSegment.position.x,
          y: lastSegment.position.y - _this.moveRange
        };
      } else if (penultSegment.position.x < lastSegment.position.x && penultSegment.position.y === lastSegment.position.y) {
        newSegment.position = {
          x: lastSegment.position.x + _this.moveRange,
          y: lastSegment.position.y
        };
      } else if (penultSegment.position.x > lastSegment.position.x && penultSegment.position.y === lastSegment.position.y) {
        newSegment.position = {
          x: lastSegment.position.x - _this.moveRange,
          y: lastSegment.position.y
        };
      }
    }

    if (newSegment != null) _this.segments.push(newSegment);
  });

  _defineProperty(this, "recalculateSegments", function (direction) {
    var buffor = _this.segments[0].position;

    for (var i = 1; i < _this.segments.length; i++) {
      var tmp = buffor;
      buffor = _this.segments[i].position;
      _this.segments[i].position = tmp;
    }

    switch (direction) {
      case _interfaces.Direction.Up:
        _this.segments[0].position = {
          x: _this.segments[0].position.x,
          y: _this.segments[0].position.y - _this.moveRange
        };
        break;

      case _interfaces.Direction.Down:
        _this.segments[0].position = {
          x: _this.segments[0].position.x,
          y: _this.segments[0].position.y + _this.moveRange
        };
        break;

      case _interfaces.Direction.Left:
        _this.segments[0].position = {
          x: _this.segments[0].position.x - _this.moveRange,
          y: _this.segments[0].position.y
        };
        break;

      case _interfaces.Direction.Right:
        _this.segments[0].position = {
          x: _this.segments[0].position.x + _this.moveRange,
          y: _this.segments[0].position.y
        };
        break;
    }
  });

  _defineProperty(this, "detectCollisions", function (canvas) {
    //endmap logic
    var segments = _this.segments;
    var head = segments[0];
    if (head.position.y < 0 || head.position.y >= canvas.height || head.position.x < 0 || head.position.x >= canvas.width) return true; //snake collision detection

    for (var i = 1; i < segments.length; i++) {
      if (head.position.x === segments[i].position.x && head.position.y === segments[i].position.y) {
        return true;
      }
    }

    return false;
  });

  _defineProperty(this, "detectedFood", function (food) {
    var head = _this.segments[0];

    if (head.position.x === food.segment.position.x && head.position.y === food.segment.position.y) {
      return true;
    }

    return false;
  });

  _defineProperty(this, "getSegments", function () {
    return _this.segments;
  });

  this.moveRange = moveRange;
  this.segments.push(new _Square.Square(position, "#0C5E62", this.moveRange));
};

exports.Snake = Snake;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9vYmplY3RzL1NuYWtlLnRzIl0sIm5hbWVzIjpbIlNuYWtlIiwicG9zaXRpb24iLCJtb3ZlUmFuZ2UiLCJkaXJlY3Rpb24iLCJsYXN0U2VnbWVudCIsInNlZ21lbnRzIiwibGVuZ3RoIiwibmV3U2VnbWVudCIsIlNxdWFyZSIsIkRpcmVjdGlvbiIsIlVwIiwieCIsInkiLCJEb3duIiwiTGVmdCIsIlJpZ2h0IiwicGVudWx0U2VnbWVudCIsInB1c2giLCJidWZmb3IiLCJpIiwidG1wIiwiY2FudmFzIiwiaGVhZCIsImhlaWdodCIsIndpZHRoIiwiZm9vZCIsInNlZ21lbnQiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7QUFBQTs7QUFFQTs7Ozs7O0lBRWFBLEssR0FJWCxlQUFZQyxRQUFaLEVBQWlDQyxTQUFqQyxFQUFvRDtBQUFBOztBQUFBOztBQUFBLG9DQUh2QixFQUd1Qjs7QUFBQTs7QUFBQSxzQ0FLaEMsVUFBQ0MsU0FBRCxFQUFnQztBQUNsRCxRQUFJQyxXQUFXLEdBQUcsS0FBSSxDQUFDQyxRQUFMLENBQWMsS0FBSSxDQUFDQSxRQUFMLENBQWNDLE1BQWQsR0FBdUIsQ0FBckMsQ0FBbEI7QUFFQSxRQUFJQyxVQUFVLEdBQUcsSUFBSUMsY0FBSixDQUFXLElBQVgsRUFBaUIsU0FBakIsRUFBNEIsS0FBSSxDQUFDTixTQUFqQyxDQUFqQjs7QUFFQSxRQUFJLEtBQUksQ0FBQ0csUUFBTCxDQUFjQyxNQUFkLEdBQXVCLENBQTNCLEVBQThCO0FBQzVCLGNBQVFILFNBQVI7QUFDRSxhQUFLTSxzQkFBVUMsRUFBZjtBQUNFSCxVQUFBQSxVQUFVLENBQUNOLFFBQVgsR0FBc0I7QUFDcEJVLFlBQUFBLENBQUMsRUFBRVAsV0FBVyxDQUFDSCxRQUFaLENBQXFCVSxDQURKO0FBRXBCQyxZQUFBQSxDQUFDLEVBQUVSLFdBQVcsQ0FBQ0gsUUFBWixDQUFxQlcsQ0FBckIsR0FBeUIsS0FBSSxDQUFDVjtBQUZiLFdBQXRCO0FBSUE7O0FBQ0YsYUFBS08sc0JB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LFdBQU8sS0FBUDtBQUNELEdBdEptRDs7QUFBQSx1Q0F3Si9CLFlBQWdCO0FBQ25DLFdBQU8sS0FBSSxDQUFDUCxRQUFaO0FBQ0QsR0ExSm1EOztBQUNsRCxPQUFLSCxTQUFMLEdBQWlCQSxTQUFqQjtBQUNBLE9BQUtHLFFBQUwsQ0FBY1ksSUFBZCxDQUFtQixJQUFJVCxjQUFKLENBQVdQLFFBQVgsRUFBcUIsU0FBckIsRUFBZ0MsS0FBS0MsU0FBckMsQ0FBbkI7QUFDRCxDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgSVBvc2l0aW9uLCBEaXJlY3Rpb24gfSBmcm9tIFwiLi4vaW50ZXJmYWNlcy9pbnRlcmZhY2VzXCI7XHJcbmltcG9ydCB7IEZvb2QgfSBmcm9tIFwiLi9Gb29kXCI7XHJcbmltcG9ydCB7IFNxdWFyZSB9IGZyb20gXCIuL1NxdWFyZVwiO1xyXG5cclxuZXhwb3J0IGNsYXNzIFNuYWtlIHtcclxuICBwcml2YXRlIHNlZ21lbnRzOiBTcXVhcmVbXSA9IFtdO1xyXG4gIHByaXZhdGUgbW92ZVJhbmdlOiBudW1iZXI7XHJcblxyXG4gIGNvbnN0cnVjdG9yKHBvc2l0aW9uOiBJUG9zaXRpb24sIG1vdmVSYW5nZTogbnVtYmVyKSB7XHJcbiAgICB0aGlzLm1vdmVSYW5nZSA9IG1vdmVSYW5nZTtcclxuICAgIHRoaXMuc2VnbWVudHMucHVzaChuZXcgU3F1YXJlKHBvc2l0aW9uLCBcIiMwQzVFNjJcIiwgdGhpcy5tb3ZlUmFuZ2UpKTtcclxuICB9XHJcblxyXG4gIHB1YmxpYyBhZGRTZWdtZW50ID0gKGRpcmVjdGlvbjogRGlyZWN0aW9uKTogdm9pZCA9PiB7XHJcbiAgICBsZXQgbGFzdFNlZ21lbnQgPSB0aGlzLnNlZ21lbnRzW3RoaXMuc2VnbWVudHMubGVuZ3RoIC0gMV07XHJcblxyXG4gICAgbGV0IG5ld1NlZ21lbnQgPSBuZXcgU3F1YXJlKG51bGwsIFwiIzM5QjRCQVwiLCB0aGlzLm1vdmVSYW5nZSk7XHJcblxyXG4gICAgaWYgKHRoaXMuc2VnbWVudHMubGVuZ3RoIDwgMikge1xyXG4gICAgICBzd2l0Y2ggKGRpcmVjdGlvbikge1xyXG4gICAgICAgIGNhc2UgRGlyZWN0aW9uLlVwOlxyXG4gICAgICAgICAgbmV3U2VnbWVudC5wb3NpdGlvbiA9IHtcclxuICAgICAgICAgICAgeDogbGFzdFNlZ21lbnQucG9zaXRpb24ueCxcclxuICAgICAgICAgICAgeTogbGFzdFNlZ21lbnQucG9zaXRpb24ueSArIHRoaXMubW92ZVJhbmdlLFxyXG4gICAgICAgICAgfTtcclxuICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgIGNhc2UgRGlyZWN0aW9uLkRvd246XHJcbiAgICAgICAgICBuZXdTZWdtZW50LnBvc2l0aW9uID0ge1xyXG4gICAgICAgICAgICB4OiBsYXN0U2VnbWVudC5wb3NpdGlvbi54LFxyXG4gICAgICAgICAgICB5OiBsYXN0U2VnbWVudC5wb3NpdGlvbi55IC0gdGhpcy5tb3ZlUmFuZ2UsXHJcbiAgICAgICAgICB9O1xyXG4gICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgY2FzZSBEaXJlY3Rpb24uTGVmdDpcclxuICAgICAgICAgIG5ld1NlZ21lbnQucG9zaXRpb24gPSB7XHJcbiAgICAgICAgICAgIHg6IGxhc3RTZWdtZW50LnBvc2l0aW9uLnggKyB0aGlzLm1vdmVSYW5nZSxcclxuICAgICAgICAgICAgeTogbGFzdFNlZ21lbnQucG9zaXRpb24ueSxcclxuICAgICAgICAgIH07XHJcbiAgICAgICAgICBicmVhaztcclxuICAgICAgICBjYXNlIERpcmVjdGlvbi5SaWdodDpcclxuICAgICAgICAgIG5ld1NlZ21lbnQucG9zaXRpb24gPSB7XHJcbiAgICAgICAgICAgIHg6IGxhc3RTZWdtZW50LnBvc2l0aW9uLnggLSB0aGlzLm1vdmVSYW5nZSxcclxuICAgICAgICAgICAgeTogbGFzdFNlZ21lbnQucG9zaXRpb24ueSxcclxuICAgICAgICAgIH07XHJcbiAgICAgICAgICBicmVhaztcclxuICAgICAgfVxyXG4gICAgfSBlbHNlIHtcclxuICAgICAgbGV0IHBlbnVsdFNlZ21lbnQgPSB0aGlzLnNlZ21lbnRzW3RoaXMuc2VnbWVudHMubGVuZ3RoIC0gMl07XHJcblxyXG4gICAgICBpZiAoXHJcbiAgICAgICAgcGVudWx0U2VnbWVudC5wb3NpdGlvbi54ID09PSBsYXN0U2VnbWVudC5wb3NpdGlvbi54ICYmXHJcbiAgICAgICAgcGVudWx0U2VnbWVudC5wb3NpdGlvbi55IDwgbGFzdFNlZ21lbnQucG9zaXRpb24ueVxyXG4gICAgICApIHtcclxuICAgICAgICBuZXdTZWdtZW50LnBvc2l0aW9uID0ge1xyXG4gICAgICAgICAgeDogbGFzdFNlZ21lbnQucG9zaXRpb24ueCxcclxuICAgICAgICAgIHk6IGxhc3RTZWdtZW50LnBvc2l0aW9uLnkgKyB0aGlzLm1vdmVSYW5nZSxcclxuICAgICAgICB9O1xyXG4gICAgICB9IGVsc2UgaWYgKFxyXG4gICAgICAgIHBlbnVsdFNlZ21lbnQucG9zaXRpb24ueCA9PT0gbGFzdFNlZ21lbnQucG9zaXRpb24ueCAmJlxyXG4gICAgICAgIHBlbnVsdFNlZ21lbnQucG9zaXRpb24ueSA+IGxhc3RTZWdtZW50LnBvc2l0aW9uLnlcclxuICAgICAgKSB7XHJcbiAgICAgICAgbmV3U2VnbWVudC5wb3NpdGlvbiA9IHtcclxuICAgICAgICAgIHg6IGxhc3RTZWdtZW50LnBvc2l0aW9uLngsXHJcbiAgICAgICAgICB5OiBsYXN0U2VnbWVudC5wb3NpdGlvbi55IC0gdGhpcy5tb3ZlUmFuZ2UsXHJcbiAgICAgICAgfTtcclxuICAgICAgfSBlbHNlIGlmIChcclxuICAgICAgICBwZW51bHRTZWdtZW50LnBvc2l0aW9uLnggPCBsYXN0U2VnbWVudC5wb3NpdGlvbi54ICYmXHJcbiAgICAgICAgcGVudWx0U2VnbWVudC5wb3NpdGlvbi55ID09PSBsYXN0U2VnbWVudC5wb3NpdGlvbi55XHJcbiAgICAgICkge1xyXG4gICAgICAgIG5ld1NlZ21lbnQucG9zaXRpb24gPSB7XHJcbiAgICAgICAgICB4OiBsYXN0U2VnbWVudC5wb3NpdGlvbi54ICsgdGhpcy5tb3ZlUmFuZ2UsXHJcbiAgICAgICAgICB5OiBsYXN0U2VnbWVudC5wb3NpdGlvbi55LFxyXG4gICAgICAgIH07XHJcbiAgICAgIH0gZWxzZSBpZiAoXHJcbiAgICAgICAgcGVudWx0U2VnbWVudC5wb3NpdGlvbi54ID4gbGFzdFNlZ21lbnQucG9zaXRpb24ueCAmJlxyXG4gICAgICAgIHBlbnVsdFNlZ21lbnQucG9zaXRpb24ueSA9PT0gbGFzdFNlZ21lbnQucG9zaXRpb24ueVxyXG4gICAgICApIHtcclxuICAgICAgICBuZXdTZWdtZW50LnBvc2l0aW9uID0ge1xyXG4gICAgICAgICAgeDogbGFzdFNlZ21lbnQucG9zaXRpb24ueCAtIHRoaXMubW92ZVJhbmdlLFxyXG4gICAgICAgICAgeTogbGFzdFNlZ21lbnQucG9zaXRpb24ueSxcclxuICAgICAgICB9O1xyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgICBpZiAobmV3U2VnbWVudCAhPSBudWxsKSB0aGlzLnNlZ21lbnRzLnB1c2gobmV3U2VnbWVudCk7XHJcbiAgfTtcclxuXHJcbiAgcHVibGljIHJlY2FsY3VsYXRlU2VnbWVudHMgPSAoZGlyZWN0aW9uOiBEaXJlY3Rpb24pID0+IHtcclxuICAgIGxldCBidWZmb3IgPSB0aGlzLnNlZ21lbnRzWzBdLnBvc2l0aW9uO1xyXG4gICAgZm9yIChsZXQgaSA9IDE7IGkgPCB0aGlzLnNlZ21lbnRzLmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgIGxldCB0bXAgPSBidWZmb3I7XHJcbiAgICAgIGJ1ZmZvciA9IHRoaXMuc2VnbWVudHNbaV0ucG9zaXRpb247XHJcbiAgICAgIHRoaXMuc2VnbWVudHNbaV0ucG9zaXRpb24gPSB0bXA7XHJcbiAgICB9XHJcblxyXG4gICAgc3dpdGNoIChkaXJlY3Rpb24pIHtcclxuICAgICAgY2FzZSBEaXJlY3Rpb24uVXA6XHJcbiAgICAgICAgdGhpcy5zZWdtZW50c1swXS5wb3NpdGlvbiA9IHtcclxuICAgICAgICAgIHg6IHRoaXMuc2VnbWVudHNbMF0ucG9zaXRpb24ueCxcclxuICAgICAgICAgIHk6IHRoaXMuc2VnbWVudHNbMF0ucG9zaXRpb24ueSAtIHRoaXMubW92ZVJhbmdlLFxyXG4gICAgICAgIH07XHJcbiAgICAgICAgYnJlYWs7XHJcbiAgICAgIGNhc2UgRGlyZWN0aW9uLkRvd246XHJcbiAgICAgICAgdGhpcy5zZWdtZW50c1swXS5wb3NpdGlvbiA9IHtcclxuICAgICAgICAgIHg6IHRoaXMuc2VnbWVudHNbMF0ucG9zaXRpb24ueCxcclxuICAgICAgICAgIHk6IHRoaXMuc2VnbWVudHNbMF0ucG9zaXRpb24ueSArIHRoaXMubW92ZVJhbmdlLFxyXG4gICAgICAgIH07XHJcbiAgICAgICAgYnJlYWs7XHJcbiAgICAgIGNhc2UgRGlyZWN0aW9uLkxlZnQ6XHJcbiAgICAgICAgdGhpcy5zZWdtZW50c1swXS5wb3NpdGlvbiA9IHtcclxuICAgICAgICAgIHg6IHRoaXMuc2VnbWVudHNbMF0ucG9zaXRpb24ueCAtIHRoaXMubW92ZVJhbmdlLFxyXG4gICAgICAgICAgeTogdGhpcy5zZWdtZW50c1swXS5wb3NpdGlvbi55LFxyXG4gICAgICAgIH07XHJcbiAgICAgICAgYnJlYWs7XHJcbiAgICAgIGNhc2UgRGlyZWN0aW9uLlJpZ2h0OlxyXG4gICAgICAgIHRoaXMuc2VnbWVudHNbMF0ucG9zaXRpb24gPSB7XHJcbiAgICAgICAgICB4OiB0aGlzLnNlZ21lbnRzWzBdLnBvc2l0aW9uLnggKyB0aGlzLm1vdmVSYW5nZSxcclxuICAgICAgICAgIHk6IHRoaXMuc2VnbWVudHNbMF0ucG9zaXRpb24ueSxcclxuICAgICAgICB9O1xyXG4gICAgICAgIGJyZWFrO1xyXG4gICAgfVxyXG4gIH07XHJcblxyXG4gIHB1YmxpYyBkZXRlY3RDb2xsaXNpb25zID0gKGNhbnZhczogSFRNTENhbnZhc0VsZW1lbnQpOiBib29sZWFuID0+IHtcclxuICAgIC8vZW5kbWFwIGxvZ2ljXHJcbiAgICBsZXQgc2VnbWVudHMgPSB0aGlzLnNlZ21lbnRzO1xyXG4gICAgbGV0IGhlYWQgPSBzZWdtZW50c1swXTtcclxuXHJcbiAgICBpZiAoXHJcbiAgICAgIGhlYWQucG9zaXRpb24ueSA8IDAgfHxcclxuICAgICAgaGVhZC5wb3NpdGlvbi55ID49IGNhbnZhcy5oZWlnaHQgfHxcclxuICAgICAgaGVhZC5wb3NpdGlvbi54IDwgMCB8fFxyXG4gICAgICBoZWFkLnBvc2l0aW9uLnggPj0gY2FudmFzLndpZHRoXHJcbiAgICApXHJcbiAgICAgIHJldHVybiB0cnVlO1xyXG5cclxuICAgIC8vc25ha2UgY29sbGlzaW9uIGRldGVjdGlvblxyXG4gICAgZm9yIChsZXQgaSA9IDE7IGkgPCBzZWdtZW50cy5sZW5ndGg7IGkrKykge1xyXG4gICAgICBpZiAoXHJcbiAgICAgICAgaGVhZC5wb3NpdGlvbi54ID09PSBzZWdtZW50c1tpXS5wb3NpdGlvbi54ICYmXHJcbiAgICAgICAgaGVhZC5wb3NpdGlvbi55ID09PSBzZWdtZW50c1tpXS5wb3NpdGlvbi55XHJcbiAgICAgICkge1xyXG4gICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgcmV0dXJuIGZhbHNlO1xyXG4gIH07XHJcblxyXG4gIHB1YmxpYyBkZXRlY3RlZEZvb2QgPSAoZm9vZDogRm9vZCk6IGJvb2xlYW4gPT4ge1xyXG4gICAgbGV0IGhlYWQgPSB0aGlzLnNlZ21lbnRzWzBdO1xyXG5cclxuICAgIGlmIChcclxuICAgICAgaGVhZC5wb3NpdGlvbi54ID09PSBmb29kLnNlZ21lbnQucG9zaXRpb24ueCAmJlxyXG4gICAgICBoZWFkLnBvc2l0aW9uLnkgPT09IGZvb2Quc2VnbWVudC5wb3NpdGlvbi55XHJcbiAgICApIHtcclxuICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICB9XHJcblxyXG4gICAgcmV0dXJuIGZhbHNlO1xyXG4gIH07XHJcblxyXG4gIHB1YmxpYyBnZXRTZWdtZW50cyA9ICgpOiBTcXVhcmVbXSA9PiB7XHJcbiAgICByZXR1cm4gdGhpcy5zZWdtZW50cztcclxuICB9O1xyXG59XHJcbiJdfQ==